/*! For license information please see users.js.LICENSE.txt */
(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(){var e,n,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",i=o.toStringTag||"@@toStringTag";function s(t,o,a,i){var s=o&&o.prototype instanceof c?o:c,l=Object.create(s.prototype);return r(l,"_invoke",function(t,r,o){var a,i,s,c=0,l=o||[],d=!1,f={p:0,n:0,v:e,a:y,f:y.bind(e,4),d:function(t,r){return a=t,i=0,s=e,f.n=r,u}};function y(t,r){for(i=t,s=r,n=0;!d&&c&&!o&&n<l.length;n++){var o,a=l[n],y=f.p,m=a[2];t>3?(o=m===r)&&(s=a[(i=a[4])?5:(i=3,3)],a[4]=a[5]=e):a[0]<=y&&((o=t<2&&y<a[1])?(i=0,f.v=r,f.n=a[1]):y<m&&(o=t<3||a[0]>r||r>m)&&(a[4]=t,a[5]=r,f.n=m,i=0))}if(o||t>1)return u;throw d=!0,r}return function(o,l,m){if(c>1)throw TypeError("Generator is already running");for(d&&1===l&&y(l,m),i=l,s=m;(n=i<2?e:s)||!d;){a||(i?i<3?(i>1&&(f.n=-1),y(i,s)):f.n=s:f.v=s);try{if(c=2,a){if(i||(o="next"),n=a[o]){if(!(n=n.call(a,s)))throw TypeError("iterator result is not an object");if(!n.done)return n;s=n.value,i<2&&(i=0)}else 1===i&&(n=a.return)&&n.call(a),i<2&&(s=TypeError("The iterator does not provide a '"+o+"' method"),i=1);a=e}else if((n=(d=f.n<0)?s:t.call(r,f))!==u)break}catch(t){a=e,i=1,s=t}finally{c=1}}return{value:n,done:d}}}(t,a,i),!0),l}var u={};function c(){}function l(){}function d(){}n=Object.getPrototypeOf;var f=[][a]?n(n([][a]())):(r(n={},a,function(){return this}),n),y=d.prototype=c.prototype=Object.create(f);function m(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,r(e,i,"GeneratorFunction")),e.prototype=Object.create(y),e}return l.prototype=d,r(y,"constructor",d),r(d,"constructor",l),l.displayName="GeneratorFunction",r(d,i,"GeneratorFunction"),r(y),r(y,i,"Generator"),r(y,a,function(){return this}),r(y,"toString",function(){return"[object Generator]"}),(t=function(){return{w:s,m}})()}function r(e,t,n,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}r=function(e,t,n,o){function i(t,n){r(e,t,function(e){return this._invoke(t,n,e)})}t?a?a(e,t,{value:n,enumerable:!o,configurable:!o,writable:!o}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},r(e,t,n,o)}function n(e,t,r,n,o,a,i){try{var s=e[a](i),u=s.value}catch(e){return void r(e)}s.done?t(u):Promise.resolve(u).then(n,o)}function o(e){return function(){var t=this,r=arguments;return new Promise(function(o,a){var i=e.apply(t,r);function s(e){n(i,o,a,s,u,"next",e)}function u(e){n(i,o,a,s,u,"throw",e)}s(void 0)})}}function a(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,i(n.key),n)}}function i(t){var r=function(t,r){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var o=n.call(t,r||"default");if("object"!=e(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===r?String:Number)(t)}(t,"string");return"symbol"==e(r)?r:r+""}new(function(){return e=function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.usersData=[],this.cardTemplate=null,this.modal=null,this.currentEditingUser=null,document.addEventListener("DOMContentLoaded",function(){t.cardTemplate=document.getElementById("userCardTemplate");var e=document.getElementById("editUserModal");e&&(t.modal=new bootstrap.Modal(e)),t.init()})},r=[{key:"init",value:(u=o(t().m(function e(){return t().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.loadUsers();case 1:this.displayUsers(),this.setupEvents();case 2:return e.a(2)}},e,this)})),function(){return u.apply(this,arguments)})},{key:"loadUsers",value:(s=o(t().m(function e(){var r,n;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,fetch("/api/users");case 1:return r=e.v,e.n=2,r.json();case 2:this.usersData=e.v,e.n=4;break;case 3:e.p=3,n=e.v,console.error("Ошибка загрузки пользователей:",n);case 4:return e.a(2)}},e,this,[[0,3]])})),function(){return s.apply(this,arguments)})},{key:"displayUsers",value:function(){var e=this;if(this.cardTemplate){var t=document.getElementById("usersContainer");t&&(t.innerHTML="",this.usersData.forEach(function(r){var n=e.createUserCard(r);t.appendChild(n)}))}}},{key:"createUserCard",value:function(e){var t=this,r=this.cardTemplate.content.cloneNode(!0).querySelector(".card");r.querySelector(".user-name").textContent="".concat(e.firstName," ").concat(e.lastName),r.querySelector(".user-role").textContent="admin"===e.role?"Администратор":"Пользователь",r.querySelector(".user-status").textContent=this.getStatusText(e.status),r.querySelector(".user-email").textContent=e.email||"",r.querySelector(".user-birthdate").textContent=e.birthDate||"";var n=r.querySelector(".user-edit-btn"),o=r.querySelector(".user-friends-btn"),a=r.querySelector(".user-messages-btn"),i=r.querySelector(".user-avatar");return i&&(i.src="/images/users/".concat(e.avatar||"default.jpg"),i.alt="".concat(e.firstName," ").concat(e.lastName)),n&&n.addEventListener("click",function(){return t.openEditModal(e)}),o&&o.addEventListener("click",function(){return t.showFriends(e.id)}),a&&a.addEventListener("click",function(){return t.showMessages(e.id)}),r}},{key:"openEditModal",value:function(e){this.modal&&(this.currentEditingUser=e,document.getElementById("editUserId").value=e.id,document.getElementById("editUserName").value="".concat(e.firstName," ").concat(e.lastName),document.getElementById("editUserRole").value=e.role,document.getElementById("editUserStatus").value=e.status,this.modal.show())}},{key:"getStatusText",value:function(e){return{active:"Активный",blocked:"Заблокирован",unconfirmed:"Не подтверждён"}[e]||e}},{key:"saveUserChanges",value:(i=o(t().m(function e(){var r,n,o,a,i,s,u;return t().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.currentEditingUser){e.n=1;break}return e.a(2);case 1:return r=this.currentEditingUser.id,n=document.getElementById("editUserName").value.split(" "),o=n[0]||"",a=n[1]||"",i=document.getElementById("editUserRole").value,s=document.getElementById("editUserStatus").value,e.p=2,e.n=3,fetch("/api/users/".concat(r),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({firstName:o,lastName:a,role:i,status:s})});case 3:e.v.ok&&(this.modal.hide(),Object.assign(this.currentEditingUser,{firstName:o,lastName:a,role:i,status:s}),this.displayUsers(),this.currentEditingUser=null),e.n=5;break;case 4:e.p=4,u=e.v,console.error("Ошибка обновления пользователя:",u);case 5:return e.a(2)}},e,this,[[2,4]])})),function(){return i.apply(this,arguments)})},{key:"showFriends",value:function(e){window.location.href="/friends.html?userId=".concat(e)}},{key:"showMessages",value:function(e){window.location.href="/messages.html?userId=".concat(e)}},{key:"setupEvents",value:function(){var e=this,t=document.getElementById("saveUserChanges");t&&t.addEventListener("click",function(){return e.saveUserChanges()})}}],r&&a(e.prototype,r),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n,i,s,u}())})();